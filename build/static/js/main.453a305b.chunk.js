(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(e,t,a){e.exports=a(24)},19:function(e,t,a){},20:function(e,t,a){},21:function(e,t,a){},23:function(e,t,a){},24:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(12),o=a.n(i),l=(a(19),a(2)),c=a(3),s=a(6),u=a(4),y=a(7),h={width:15,height:25},d={width:300,height:500},p=20,v=(a(20),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(s.a)(this,Object(u.a)(t).call(this,e))).canvas=r.a.createRef(),a.ctx=null,a}return Object(y.a)(t,e),Object(c.a)(t,[{key:"getCanvasContext",value:function(){this.ctx=this.canvas.current.getContext("2d")}},{key:"clearCanvas",value:function(){var e=this.canvas.current,t=e.width,a=e.height;this.ctx.clearRect(0,0,t,a)}},{key:"drawCell",value:function(e,t){var a=this,n=p,r=n/8,i=n-2*r,o=e.x*n,l=e.y*n;this.ctx.fillStyle=t||e.color,this.ctx.fillRect(o+r,l+r,i,i);var c=function(e){var t=e.coords,n=e.color;a.ctx.fillStyle=n,a.ctx.beginPath(),a.ctx.moveTo(t[0].x,t[0].y),a.ctx.lineTo(t[1].x,t[1].y),a.ctx.lineTo(t[2].x,t[2].y),a.ctx.lineTo(t[3].x,t[3].y),a.ctx.lineTo(t[0].x,t[0].y),a.ctx.fill()},s={color:"#0000d8",coords:[{x:o,y:l},{x:o+r,y:l+r},{x:o+r,y:l+n-r},{x:o,y:l+n}]},u={color:"#0000d8",coords:[{x:o+n-r,y:l+r},{x:o+n,y:l},{x:o+n,y:l+n},{x:o+n-r,y:l+n-r}]},y={color:"#000078",coords:[{x:o+r,y:l+n-r},{x:o,y:l+n},{x:o+n,y:l+n},{x:o+n-r,y:l+n-r}]};c({color:"#b3b3fb",coords:[{x:o,y:l},{x:o+r,y:l+r},{x:o+n-r,y:l+r},{x:o+n,y:l}]}),c(s),c(u),c(y)}},{key:"drawCells",value:function(e,t){var a=this;e.forEach(function(e){return a.drawCell(e,t)})}},{key:"redrawCanvas",value:function(){var e=this.props.state,t=e.filledCells,a=e.activeShape;this.clearCanvas(),this.drawCells(t),this.drawCells(a.cells,a.color)}},{key:"componentDidMount",value:function(){this.getCanvasContext()}},{key:"componentDidUpdate",value:function(){this.redrawCanvas()}},{key:"render",value:function(){var e=d,t=e.width,a=e.height;return r.a.createElement("canvas",{ref:this.canvas,className:"field",width:t,height:a})}}]),t}(n.Component)),x=a(1),f=[{color:"#00f0f0",rotations:[[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:0,y:3}]]},{color:"#f0f000",rotations:[[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}]]},{color:"#a000f0",rotations:[[{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:2,y:1}],[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:0,y:2}],[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],[{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:2}]]},{color:"#0000f0",rotations:[[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:2,y:1}],[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:2}],[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:2,y:1}],[{x:1,y:0},{x:1,y:1},{x:0,y:2},{x:1,y:2}]]},{color:"#00f000",rotations:[[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:2}]]},{color:"#f0a000",rotations:[[{x:2,y:0},{x:0,y:1},{x:1,y:1},{x:2,y:1}],[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:0,y:1}],[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:1,y:2}]]},{color:"#f00000",rotations:[[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}],[{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:0,y:2}]]}],E=function(e,t){if(void 0!==e&&void 0!==t){var a=f[e];return{type:e,rotation:t,color:a.color,cells:a.rotations[t]}}var n=f.length,r=Math.floor(Math.random()*n),i=f[r],o=i.color,l=i.rotations.length,c=Math.floor(Math.random()*l);return{type:r,rotation:c,color:o,cells:i.rotations[c]}},S=function(e){var t=e.type,a=e.rotation,n=e.cells,r=E(t,a).cells,i=function(e){var t=e.type,a=e.rotation+1;return a===f[t].rotations.length&&(a=0),{rotation:a,cells:E(t,a).cells}}(e),o=i.cells,l=i.rotation,c=function(e,t){return e.map(function(e,a){return{x:t[a].x-e.x,y:t[a].y-e.y}})}(r,o),s=n.map(function(e,t){return{x:e.x+c[t].x,y:e.y+c[t].y}});return Object(x.a)({},e,{rotation:l,cells:s})},m=function(e){var t=e.nextShape;if(!t)return r.a.createElement("svg",{width:50,height:50});var a=t.type,n=t.rotation,i=E(a,n),o=i.color,l=i.cells,c=l.reduce(function(e,t){return t.x>e?t.x:e},0),s=l.map(function(e){var t=(3-c)/2;return{x:12.5*(e.x+t),y:12.5*e.y}});return r.a.createElement("svg",{width:35,height:35,viewBox:"0 0 50 50"},s.map(function(e,t){return r.a.createElement("rect",{key:t,x:e.x,y:e.y,width:12.5,height:12.5,style:{fill:o,stroke:"red"}})}))},g=(a(21),a(5)),b=a(9),A={score:0,lines:0,level:1},w=Object(g.a)({filledCells:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"START_GAME":return[];case"CLEAR_LINE":var a=t.payload.number;return e.filter(function(e){return e.y!==a}).map(function(e){return Object(x.a)({},e,{y:e.y+(e.y<a?1:0)})});case"REPLACE_SHAPE":var n=t.payload.prevShape,r=n.cells.map(function(e){return{x:e.x,y:e.y,color:n.color}});return[].concat(Object(b.a)(e),Object(b.a)(r));default:return e}},activeShape:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"START_GAME":case"REPLACE_SHAPE":var a=t.payload.activeShape,n=a.cells,r=n.reduce(function(e,t){return{width:t.x>e.width?t.x:e.width,height:t.y>e.height?t.y:e.height}},{width:0,height:0}),i=Math.floor(h.width/2)-Math.floor(r.width/2),o=-r.height;return Object(x.a)({},a,{cells:n.map(function(e){return{x:e.x+i,y:e.y+o}})});case"MAKE_MOVE":return Object(x.a)({},e,{cells:e.cells.map(function(e){return{x:e.x,y:e.y+1}})});case"ROTATE_SHAPE":return S(e);case"MOVE_SHAPE":var l="left"===t.payload.direction?-1:1;return Object(x.a)({},e,{cells:e.cells.map(function(e){return Object(x.a)({},e,{x:e.x+l})})});default:return e}},nextShape:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"START_GAME":case"REPLACE_SHAPE":return t.payload.nextShape;default:return e}},isPlaying:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];switch((arguments.length>1?arguments[1]:void 0).type){case"START_GAME":case"RESUME_GAME":return!0;case"PAUSE_GAME":case"FINISH_GAME":return!1;default:return e}},info:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A;switch((arguments.length>1?arguments[1]:void 0).type){case"MAKE_MOVE":return Object(x.a)({},e,{score:e.score+e.level/10});case"CLEAR_LINE":var t=Math.floor((e.lines+1)/5)+1;return{score:e.score+100*e.level,lines:e.lines+1,level:t>9?9:t};case"START_GAME":return A;default:return e}},isOver:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];switch((arguments.length>1?arguments[1]:void 0).type){case"START_GAME":return!1;case"FINISH_GAME":return!0;default:return e}},speedUp:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];switch((arguments.length>1?arguments[1]:void 0).type){case"REPLACE_SHAPE":case"DECREASE_SPEED":return!1;case"INCREASE_SPEED":return!0;default:return e}}}),M=Object(g.b)(w),T=function(e){var t=E(),a=t.type,n=t.rotation;return{type:"START_GAME",payload:{activeShape:E(),nextShape:{type:a,rotation:n},cellSide:e}}},_=function(e){return{type:"MOVE_SHAPE",payload:{direction:e}}},P=function(){var e=M.getState(),t=e.nextShape,a=e.isPlaying,n=e.isOver,i=e.info;return r.a.createElement("div",{className:"info"},r.a.createElement("button",{id:"toggle-playing",onClick:function(){a?M.dispatch({type:"PAUSE_GAME"}):n?M.dispatch(T()):M.dispatch({type:"RESUME_GAME"})}},a?"PAUSE":"PLAY"),r.a.createElement("span",null,r.a.createElement("b",null,"NEXT SHAPE:")),r.a.createElement(m,{nextShape:t}),r.a.createElement("span",null,r.a.createElement("b",null,"SCORE:"),Math.floor(i.score)),r.a.createElement("span",null,r.a.createElement("b",null,"LEVEL:"),i.level),r.a.createElement("span",null,r.a.createElement("b",null,"LINES:"),i.lines))},k=(a(23),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(s.a)(this,Object(u.a)(t).call(this,e))).timer=null,a.speedTimer=null,a}return Object(y.a)(t,e),Object(c.a)(t,[{key:"canShapeRotate",value:function(){var e=S(M.getState().activeShape).cells;return this.isLegalShapePosition(e)}},{key:"canShapeMoveTo",value:function(e){var t=M.getState().activeShape,a="left"===e?-1:1,n=t.cells.map(function(e){return{x:e.x+a,y:e.y}});return this.isLegalShapePosition(n)}},{key:"addKeyListeners",value:function(){var e=this;document.body.addEventListener("keydown",function(t){t.preventDefault();var a=M.getState(),n=a.isPlaying,r=a.isOver,i=a.speedUp;if(n)switch(t.code){case"ArrowUp":e.canShapeRotate()&&M.dispatch({type:"ROTATE_SHAPE"});break;case"ArrowLeft":e.canShapeMoveTo("left")&&M.dispatch(_("left"));break;case"ArrowRight":e.canShapeMoveTo("right")&&M.dispatch(_("right"));break;case"ArrowDown":i||M.dispatch({type:"INCREASE_SPEED"});break;case"Space":M.dispatch({type:"PAUSE_GAME"})}else"Space"===t.code&&(r?M.dispatch(T()):M.dispatch({type:"RESUME_GAME"}))}),document.body.addEventListener("keyup",function(e){M.getState().isPlaying&&"ArrowDown"===e.code&&M.dispatch({type:"DECREASE_SPEED"})})}},{key:"addTouchListeners",value:function(){var e=this,t=null,a=!1,n=function(n){var r=M.getState(),i=r.isPlaying,o=r.speedUp;if(i&&"toggle-playing"!==n.changedTouches[0].target.id){n.preventDefault();var l=n.changedTouches[0],c=l.clientX,s=l.clientY;if("touchstart"===n.type)t={clientX:c,clientY:s};else if("touchmove"===n.type){a||(a=!0);var u=t.clientX-c,y=t.clientY-s,h=Math.abs(u)>3*Math.abs(y)?u>0?"left":"right":Math.abs(y)>3*Math.abs(u)?y>0?"top":"bottom":void 0;h&&(Math.abs(u)>15||Math.abs(y)>15)&&(t={clientX:c,clientY:s}),"left"===h&&Math.abs(u)>15?e.canShapeMoveTo("left")&&M.dispatch(_("left")):"right"===h&&Math.abs(u)>15?e.canShapeMoveTo("right")&&M.dispatch(_("right")):"bottom"===h&&Math.abs(y)>15?o||M.dispatch({type:"INCREASE_SPEED"}):"top"===h&&Math.abs(y)>15&&o&&M.dispatch({type:"DECREASE_SPEED"})}else"touchend"===n.type&&(!a&&e.canShapeRotate()&&M.dispatch({type:"ROTATE_SHAPE"}),t=null,a=!1)}};document.body.addEventListener("touchstart",n,{passive:!1}),document.body.addEventListener("touchmove",n,{passive:!1}),document.body.addEventListener("touchend",n,{passive:!1})}},{key:"addListeners",value:function(){this.addKeyListeners(),this.addTouchListeners()}},{key:"isLegalShapePosition",value:function(e){var t=M.getState().filledCells,a=h,n=a.width,r=a.height,i=!0,o=!1,l=void 0;try{for(var c,s=t[Symbol.iterator]();!(i=(c=s.next()).done);i=!0){var u=c.value,y=!0,d=!1,p=void 0;try{for(var v,x=e[Symbol.iterator]();!(y=(v=x.next()).done);y=!0){var f=v.value;if(u.x===f.x&&u.y===f.y)return!1}}catch(w){d=!0,p=w}finally{try{y||null==x.return||x.return()}finally{if(d)throw p}}}}catch(w){o=!0,l=w}finally{try{i||null==s.return||s.return()}finally{if(o)throw l}}var E=!0,S=!1,m=void 0;try{for(var g,b=e[Symbol.iterator]();!(E=(g=b.next()).done);E=!0){var A=g.value;if(A.y>=r)return!1;if(A.x<0||A.x>=n)return!1}}catch(w){S=!0,m=w}finally{try{E||null==b.return||b.return()}finally{if(S)throw m}}return!0}},{key:"clearFullLines",value:function(){for(var e=h,t=e.width,a=function(e){var a=M.getState().filledCells.filter(function(t){return t.y===e}).length;if(a===t)M.dispatch({type:"CLEAR_LINE",payload:{number:e}});else{if(!a)return n=e,"break";e--}n=e},n=e.height-1;n>=0;){if("break"===a(n))break}}},{key:"isShapeOutsideField",value:function(){var e=M.getState().activeShape.cells,t=!0,a=!1,n=void 0;try{for(var r,i=e[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){if(r.value.y<0)return!0}}catch(o){a=!0,n=o}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}return!1}},{key:"handleMove",value:function(){var e=M.getState(),t=e.activeShape,a=e.nextShape,n=t.cells.map(function(e){return{x:e.x,y:e.y+1}});return this.isLegalShapePosition(n)?M.dispatch({type:"MAKE_MOVE"}):this.isShapeOutsideField()?M.dispatch({type:"FINISH_GAME"}):(M.dispatch(function(e,t){var a=t.type,n=t.rotation,r=E();return{type:"REPLACE_SHAPE",payload:{prevShape:e,activeShape:E(a,n),nextShape:{type:r.type,rotation:r.rotation}}}}(t,a)),this.clearFullLines(),void M.dispatch({type:"MAKE_MOVE"}))}},{key:"updateTimers",value:function(){var e=this,t=M.getState(),a=t.isPlaying,n=t.speedUp,r={normal:2+t.info.level,speedUp:20},i=function(e){return clearInterval(e),null},o=function(t){return setInterval(function(){return e.handleMove()},1e3/t)};a?n?(this.timer&&(this.timer=i(this.timer)),this.speedTimer||(this.speedTimer=o(r.speedUp))):(this.timer||(this.timer=o(r.normal)),this.speedTimer&&(this.speedTimer=i(this.speedTimer))):(this.timer&&(this.timer=i(this.timer)),this.speedTimer&&(this.speedTimer=i(this.speedTimer)))}},{key:"componentDidMount",value:function(){this.addListeners()}},{key:"componentDidUpdate",value:function(){this.updateTimers()}},{key:"render",value:function(){return r.a.createElement("div",{className:"app"},r.a.createElement(v,{state:M.getState()}),r.a.createElement(P,null))}}]),t}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var C=function(){return o.a.render(r.a.createElement(k,null),document.getElementById("root"))};M.subscribe(C),C(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[14,1,2]]]);
//# sourceMappingURL=main.453a305b.chunk.js.map